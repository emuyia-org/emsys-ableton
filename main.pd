#N canvas 0 32 1680 950 12;
#X obj 595 404 midiout;
#X msg 571 333 250;
#X msg 622 333 251;
#X obj 571 285 bng 38 250 50 0 empty empty start> 17 7 0 10 #00ff28 #000000 #e1e1e1;
#X obj 624 298 bng 25 250 50 0 empty empty cont> 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 680 285 bng 38 250 50 0 empty empty stop> 17 7 0 10 #ff0035 #000000 #e1e1e1;
#X obj 951 278 counter 0 0 5;
#X obj 1089 156 midirealtimein;
#X obj 951 308 sel 0;
#X obj 1150 280 bng 25 250 50 0 empty empty >stop 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1105 280 bng 25 250 50 0 empty empty >cont 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1059 280 bng 25 250 50 0 empty empty >start 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1027 214 gate 0, f 12;
#X obj 1027 175 tgl 25 0 empty empty clock\ in 17 7 0 10 #191919 #e1e1e1 #e1e1e1 0 1;
#X obj 951 339 counter 0 0 3;
#X obj 951 368 sel 0;
#X obj 951 397 bng 52 50 25 0 empty empty 1/4\ note\ pulse -78 26 0 13 #f77d17 #5061ff #e1e1e1;
#X msg 985 130 1;
#X msg 1073 125 0;
#X obj 951 248 sel 248;
#X obj 1059 248 sel 250 251 252, f 23;
#X obj 594 212 stripnote;
#X obj 594 251 sel 41 40;
#X obj 594 182 notein;
#X obj 904 85 t, f 8;
#X text 1321 2326 ., f 3;
#X msg 595 372 \$1;
#X obj 524 406 s to-mcl;
#N canvas 1440 0 1600 836 emsys_debug 0;
#X obj 43 95 loadbang;
#X obj 570 38 notein;
#X msg 570 129 note: \$1 \, vel: \$2 \, ch: \$3;
#X obj 570 90 pack f f f;
#X obj 567 173 spigot;
#X obj 42 154 print sys;
#X msg 43 125 welcome;
#X obj 631 167 tgl 20 0 empty empty debug\ MIDI 0 -10 0 12 #000000 #dfdfdf #dfdfdf 0 1;
#X obj 134 86 r to-mcl;
#X obj 134 117 print to-mcl;
#X obj 136 146 r from-mcl;
#X obj 136 177 print from-mcl;
#X obj 570 199 print from-midi;
#X msg 673 53 pgm \$1;
#X obj 269 154 spigot;
#X obj 321 126 tgl 20 0 empty empty debug\ rt\ MIDI 0 -10 0 12 #000000 #dfdfdf #dfdfdf 0 1;
#X obj 256 60 midirealtimein;
#X obj 258 102 sel 248;
#X obj 423 68 sysexin;
#X obj 416 183 print from-sysex;
#X obj 674 21 pgmin;
#X obj 671 88 print from-midi;
#X obj 262 188 print from-midi_rt;
#X obj 422 139 spigot;
#X obj 474 111 tgl 20 0 empty empty debug\ sysex 0 -10 0 12 #000000 #dfdfdf #dfdfdf 0 1;
#X connect 0 0 6 0;
#X connect 1 0 3 0;
#X connect 1 1 3 1;
#X connect 1 2 3 2;
#X connect 2 0 4 0;
#X connect 3 0 2 0;
#X connect 4 0 12 0;
#X connect 6 0 5 0;
#X connect 7 0 4 1;
#X connect 8 0 9 0;
#X connect 10 0 11 0;
#X connect 13 0 21 0;
#X connect 14 0 22 0;
#X connect 15 0 14 1;
#X connect 16 0 17 0;
#X connect 17 1 14 0;
#X connect 18 0 23 0;
#X connect 20 0 13 0;
#X connect 23 0 19 0;
#X connect 24 0 23 1;
#X restore 66 29 pd emsys_debug;
#X obj 151 947 realtime;
#X floatatom 151 1028 8 0 0 2 latency\ to\ and\ back - - 0;
#X obj 164 897 onebang;
#X obj 147 861 bng 25 250 50 0 empty empty empty 17 7 0 10 #191919 #ffffff #ffffff;
#X msg 680 333 252;
#X obj 1181 1190 pgmout 15;
#X obj 624 984 bng 52 300 200 0 empty empty load\ beat 17 7 0 10 #00063f #deff00 #e1e1e1;
#X obj 474 991 realtime;
#X obj 475 960 t, f 9;
#X obj 476 1265 del;
#X obj 476 1301 bng 25 250 50 0 empty empty predicted\ beat\ 1 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 474 1065 avg;
#X floatatom 474 1108 11 0 0 0 avg\ beat\ time - - 16;
#X msg 417 1002 clear;
#X obj 652 814 nbx 4 18 6 64 0 0 empty empty pattern\ beat\ len 0 -8 0 10 #191919 #e1e1e1 #e1e1e1 0 256;
#X obj 652 839 - 1;
#X msg 476 1342 250;
#X obj 417 1493 midiout;
#X floatatom 476 1028 12 0 0 0 rolling\ beat\ time - - 16;
#X obj 443 764 sel 0;
#X obj 417 798 gate 1;
#X obj 412 764 tgl 25 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1 0 1;
#X obj 419 823 t;
#X msg 466 856 0;
#X obj 419 856 bng 25 250 50 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X msg 414 732 1;
#X obj 412 705 loadbang;
#X obj 595 873 counter 0 0 15;
#X obj 692 839 - 3;
#X obj 595 930 sel 13;
#X obj 525 1166 sel 1;
#X obj 525 1195 bng 25 250 50 0 empty empty downbeat 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 151 984 avg;
#X msg 215 948 clear;
#X obj 286 758 loadbang;
#X obj 288 810 tgl 25 0 empty empty calibrate\ midi\ latency 17 7 0 10 #7e0a0e #fffded #e1e1e1 0 1;
#X msg 244 898 0;
#X obj 243 841 sel 1;
#X msg 288 783 1;
#X obj 288 840 metro 500;
#X obj 243 871 delay 5000;
#X obj 151 1054 / 2;
#X obj 478 1151 -;
#X obj 543 930 sel 0;
#X obj 512 1230 onebang, f 14;
#X obj 1181 1155 f;
#X msg 534 1343 252;
#X obj 995 910 text get set;
#X floatatom 995 879 5 0 129 0 - - - 12;
#X obj 1017 979 list;
#X obj 996 1011 list trim;
#X obj 995 1053 route md mnm rep len tin;
#X floatatom 995 1092 5 0 0 0 md\ pgm - - 12;
#X floatatom 1022 1120 5 0 0 0 mnm\ pgm - - 12;
#X floatatom 1049 1141 5 0 0 0 repeats - - 12;
#X floatatom 1077 1179 5 0 0 0 beat\ length - - 12;
#X floatatom 1104 1205 5 0 0 0 mnm\ TIn - - 12;
#X obj 1073 946 sel 2;
#X obj 1073 979 bng 25 250 50 0 empty empty schedule\ end 24 12 0 14 #191919 #e1e1e1 #e1e1e1;
#X obj 963 1053 bng 25 250 50 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 451 1389 f;
#X obj 417 1421 gate 0, f 8;
#X obj 417 1380 tgl 25 0 empty empty transport\ interrupt 17 7 0 10 #191919 #e1e1e1 #e1e1e1 0 1;
#X obj 1001 1370 counter 0 0 3;
#X obj 1063 1327 - 1;
#X floatatom 1001 1406 6 0 0 0 repeat\ no. - - 16;
#X obj 988 1475 sel 3;
#X msg 288 1332 1;
#X msg 362 1329 0;
#X obj 254 1366 gate 0;
#X obj 1274 1190 pgmout 16;
#X obj 1274 1155 f;
#X obj 1394 1108 bng 25 250 50 0 empty empty pgmout\ bang 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1201 734 bng 25 250 50 0 empty empty cont 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1239 734 bng 25 250 50 0 empty empty reset 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 1201 831 counter;
#X obj 680 251 r stop;
#X obj 538 251 r start;
#X obj 653 103 keyup;
#X obj 653 154 s start;
#X obj 678 186 s stop;
#X obj 653 127 sel 112 108;
#X obj 1239 777 t;
#X obj 1239 702 r stop;
#X obj 1063 1297 f;
#X obj 1108 1297 f;
#X obj 1188 1297 f;
#X obj 1176 1533 sel 0;
#X obj 1176 1499 change;
#X obj 1176 1639 s stop;
#X obj 1176 1568 onebang;
#X obj 1176 1603 bng 25 250 50 0 empty empty end 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 995 944 list split 2;
#X obj 1133 667 onebang;
#X obj 1394 1173 print pgm;
#X obj 1056 794 print advance_set;
#X obj 304 1493 print interrupt;
#X msg 254 1406 gate=\$1;
#X obj 1067 1469 sel 0;
#X obj 1133 703 t b b;
#X obj 1079 637 r stop;
#X msg 1079 664 stop;
#X obj 1246 1499 r stop;
#X msg 1246 1526 stop;
#X obj 373 1457 gate 1;
#X obj 373 1422 tgl 25 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1 0 1;
#X obj 336 1395 loadbang;
#X obj 144 548 text define set;
#X symbolatom 144 370 22 0 0 0 Set\ Name: - - 24;
#X obj 247 548 print;
#X obj 144 299 bng 25 250 50 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 144 403 list fromsymbol;
#X obj 307 403 list fromsymbol;
#X obj 144 338 t;
#X obj 144 437 list append;
#X obj 144 471 list tosymbol;
#X msg 144 505 read \$1;
#X obj 217 607 s stop;
#X obj 217 575 bng 25 250 50 0 empty empty empty 17 7 0 10 #191919 #e1e1e1 #e1e1e1;
#X obj 144 261 loadbang;
#X msg 307 373 symbol .mset;
#X obj 1133 637 r load;
#X obj 587 1195 r load;
#X obj 334 871 s stop;
#X obj 709 362 s stop_press;
#X obj 498 368 s start_press;
#X obj 147 795 r stop_press;
#X obj 147 819 r start_press;
#X obj 1059 317 s mcl_start;
#X obj 1105 344 s mcl_cont;
#X obj 675 394 s cont_press;
#X obj 669 215 r cont;
#X obj 1151 317 s mcl_stop;
#X obj 163 766 r mcl_start;
#X obj 904 47 r mcl_start;
#X obj 439 652 r mcl_start;
#X obj 566 824 r mcl_start;
#X obj 379 937 r mcl_start;
#X obj 951 460 s mcl_4pulse;
#X obj 566 774 r mcl_4pulse;
#X obj 566 800 r mcl_stop;
#X obj 440 675 r mcl_stop;
#X obj 380 915 r mcl_stop;
#X obj 164 741 r mcl_stop;
#X obj 1072 94 r mcl_stop;
#X obj 983 94 r mcl_cont;
#X obj 624 1049 s load;
#X text 566 1323 bug: sending an interrupt to both MCL & MnM with stop signal included it is more guaranteed to do a clean interrupt \, but NOT whole MCL is loading a new row, f 19;
#X obj 49 259 r stop_press;
#X text 1126 885 todo: change mset format for pgm messages so that it takes elektron bank format (A01 \, etc.) and converts to pgm, f 24;
#X text 1176 1010 note: pgmout needs to be sent separately \, before all the rest of the params. PGM needs to be before the next part \, and the other params need to be immediately before the next part otherwise it will affect the current part's playback., f 40;
#X msg 340 1426 0;
#X text 475 1456 bug: (untested) disabled for now as i dont have mnm with me for further tests, f 12;
#X text 217 250 note: dont write or store within the patch because this seems to create garbled characters that mess up the [list] and [route] parsing. just read and edit files in a separate editor, f 31;
#X text 1077 576 note: only progress set when end of 'repeats' is cleared (onebang) \, then trigger change on load beat, f 30;
#X obj 64 183 dac~, f 17;
#X obj 94 85 adc~ 3 4;
#X text 263 101 todo: make this all presentable somehow in presentation mode, f 20;
#X msg 1175 1448 set -1;
#X obj 1175 1394 < 1;
#X obj 1175 1421 sel 1;
#X text 1220 1394 note: fixes bug where seg doesn't end if last seg rep length is 1, f 17;
#X obj 64 85 tgl 25 0 empty empty monitor\ audio -6 -9 0 12 #191919 #00c5ff #e1e1e1 0 1;
#X obj 153 147 xgate~ 1 250;
#X obj 64 148 xgate~ 1 250;
#X obj 1067 1501 s seg_start;
#X obj 1218 1250 r seg_start;
#X text 334 1148 bug: if tempo is changed during avg beat time calculation then transport interrupt will likely fail to be on time, f 19;
#X obj 1059 1021 print seg;
#X obj 988 1505 s seg_last;
#X obj 1191 637 r seg_last;
#X obj 286 1301 r seg_last;
#X obj 361 1301 r seg_start;
#X obj 543 973 s beat1;
#X obj 974 1327 r beat1;
#X obj 383 958 r beat1;
#X obj 1188 1334 s tin?;
#X obj 238 1301 r tin?;
#X obj 1108 1334 s beat_len;
#X obj 664 776 r beat_len;
#X connect 1 0 26 0;
#X connect 2 0 26 0;
#X connect 3 0 1 0;
#X connect 3 0 154 0;
#X connect 4 0 2 0;
#X connect 4 0 159 0;
#X connect 5 0 33 0;
#X connect 5 0 153 0;
#X connect 6 0 8 0;
#X connect 7 0 12 1;
#X connect 7 0 20 0;
#X connect 8 0 14 0;
#X connect 9 0 161 0;
#X connect 10 0 158 0;
#X connect 11 0 157 0;
#X connect 12 0 19 0;
#X connect 13 0 12 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;
#X connect 16 0 167 0;
#X connect 17 0 13 0;
#X connect 18 0 13 0;
#X connect 19 0 6 0;
#X connect 20 0 11 0;
#X connect 20 1 10 0;
#X connect 20 2 9 0;
#X connect 21 0 22 0;
#X connect 22 0 3 0;
#X connect 22 1 5 0;
#X connect 23 0 21 0;
#X connect 23 1 21 1;
#X connect 24 0 17 0;
#X connect 24 1 6 2;
#X connect 24 1 14 2;
#X connect 26 0 0 0;
#X connect 26 0 27 0;
#X connect 29 0 61 0;
#X connect 30 0 70 0;
#X connect 31 0 29 1;
#X connect 32 0 31 1;
#X connect 32 0 29 0;
#X connect 33 0 26 0;
#X connect 35 0 175 0;
#X connect 36 0 47 0;
#X connect 37 0 36 0;
#X connect 37 1 36 1;
#X connect 38 0 39 0;
#X connect 39 0 45 0;
#X connect 40 0 41 0;
#X connect 41 0 71 0;
#X connect 42 0 40 0;
#X connect 43 0 44 0;
#X connect 43 0 57 0;
#X connect 44 0 56 4;
#X connect 45 0 89 0;
#X connect 47 0 40 0;
#X connect 48 1 49 1;
#X connect 49 0 51 0;
#X connect 50 0 49 0;
#X connect 51 0 53 0;
#X connect 51 1 52 0;
#X connect 52 0 50 0;
#X connect 53 0 42 0;
#X connect 54 0 50 0;
#X connect 55 0 54 0;
#X connect 56 0 37 0;
#X connect 56 0 48 0;
#X connect 56 0 58 0;
#X connect 56 0 72 0;
#X connect 56 2 59 0;
#X connect 57 0 58 1;
#X connect 58 0 35 0;
#X connect 59 0 60 0;
#X connect 60 0 73 0;
#X connect 61 0 30 0;
#X connect 62 0 61 0;
#X connect 63 0 67 0;
#X connect 64 0 66 0;
#X connect 64 0 68 0;
#X connect 65 0 64 0;
#X connect 66 0 62 0;
#X connect 66 0 69 0;
#X connect 67 0 64 0;
#X connect 68 0 152 0;
#X connect 69 0 65 0;
#X connect 70 0 71 1;
#X connect 71 0 38 1;
#X connect 72 0 202 0;
#X connect 73 0 38 0;
#X connect 73 0 75 0;
#X connect 74 0 34 0;
#X connect 75 0 89 0;
#X connect 76 0 121 0;
#X connect 76 1 86 0;
#X connect 77 0 76 0;
#X connect 78 0 121 0;
#X connect 79 0 80 0;
#X connect 79 0 88 0;
#X connect 79 0 197 0;
#X connect 80 0 81 0;
#X connect 80 1 82 0;
#X connect 80 2 83 0;
#X connect 80 3 84 0;
#X connect 80 4 85 0;
#X connect 81 0 74 1;
#X connect 82 0 100 1;
#X connect 83 0 113 1;
#X connect 84 0 114 1;
#X connect 85 0 115 1;
#X connect 86 0 87 0;
#X connect 87 0 119 1;
#X connect 88 0 92 2;
#X connect 89 0 90 1;
#X connect 90 0 133 1;
#X connect 91 0 90 0;
#X connect 92 0 94 0;
#X connect 93 0 92 4;
#X connect 93 0 95 1;
#X connect 93 0 188 0;
#X connect 94 0 95 0;
#X connect 94 0 117 0;
#X connect 94 0 127 0;
#X connect 95 0 198 0;
#X connect 96 0 98 1;
#X connect 97 0 91 0;
#X connect 98 0 91 0;
#X connect 98 0 126 0;
#X connect 100 0 99 0;
#X connect 101 0 74 0;
#X connect 101 0 100 0;
#X connect 101 0 123 0;
#X connect 102 0 104 0;
#X connect 102 0 124 0;
#X connect 103 0 111 0;
#X connect 104 0 77 0;
#X connect 105 0 5 0;
#X connect 106 0 3 0;
#X connect 107 0 110 0;
#X connect 110 0 108 0;
#X connect 110 1 109 0;
#X connect 111 0 101 0;
#X connect 111 1 104 3;
#X connect 112 0 103 0;
#X connect 113 0 93 0;
#X connect 114 0 207 0;
#X connect 115 0 205 0;
#X connect 116 0 119 0;
#X connect 117 0 116 0;
#X connect 119 0 120 0;
#X connect 120 0 118 0;
#X connect 121 0 79 0;
#X connect 121 1 78 0;
#X connect 122 0 128 0;
#X connect 126 0 125 0;
#X connect 127 0 194 0;
#X connect 128 0 101 0;
#X connect 128 1 102 0;
#X connect 129 0 130 0;
#X connect 130 0 122 0;
#X connect 131 0 132 0;
#X connect 132 0 119 0;
#X connect 133 0 46 0;
#X connect 133 0 125 0;
#X connect 134 0 133 0;
#X connect 135 0 180 0;
#X connect 136 1 147 0;
#X connect 137 0 140 0;
#X connect 139 0 142 0;
#X connect 140 0 143 0;
#X connect 141 0 143 1;
#X connect 142 0 137 0;
#X connect 142 1 149 0;
#X connect 143 0 144 0;
#X connect 144 0 145 0;
#X connect 145 0 138 0;
#X connect 145 0 136 0;
#X connect 147 0 146 0;
#X connect 148 0 139 0;
#X connect 149 0 141 0;
#X connect 150 0 122 0;
#X connect 151 0 73 1;
#X connect 155 0 32 0;
#X connect 156 0 32 0;
#X connect 160 0 4 0;
#X connect 162 0 31 0;
#X connect 163 0 24 0;
#X connect 164 0 54 0;
#X connect 165 0 56 2;
#X connect 166 0 42 0;
#X connect 168 0 56 0;
#X connect 169 0 56 2;
#X connect 170 0 54 0;
#X connect 171 0 42 0;
#X connect 172 0 31 0;
#X connect 173 0 18 0;
#X connect 174 0 17 0;
#X connect 177 0 139 0;
#X connect 180 0 134 0;
#X connect 185 0 193 0;
#X connect 185 1 192 0;
#X connect 187 0 117 0;
#X connect 188 0 189 0;
#X connect 189 0 187 0;
#X connect 191 0 192 0;
#X connect 191 0 193 0;
#X connect 192 0 184 1;
#X connect 193 0 184 0;
#X connect 195 0 115 0;
#X connect 195 0 114 0;
#X connect 195 0 113 0;
#X connect 199 0 122 1;
#X connect 200 0 96 0;
#X connect 201 0 97 0;
#X connect 203 0 92 0;
#X connect 204 0 42 0;
#X connect 206 0 98 0;
#X connect 208 0 43 0;
